/*! gazeTargets 03-08-2015 */
!function(a){"use strict";function b(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.GazeTargets.Utils,s=[],t=b,u=20,v=500,w=20,x=0,y=-1,z=!1,A=new a.GazeTargets.FullScreen,B=function(a){r.debug("CalibrationVerifier","onFullScreenChanged, e = "),console.log(a),y>=0||A.isActive&&F()},C=function(a){r.debug("CalibrationVerifier","onFullScreenError, e = "),console.log(a)};A.addEventListener("change",B),A.addEventListener("error",C),this.run=function(a,b){j=r.extend(!0,{},b),t=r.extend(!0,{},t,a),q=r.getScreenSize(),E(),c||D(),e.style.display="none",f.style.display="none",h.style.display="none",i.style.display="none",t.display?(c.style.display="block",d.style.display="block",A.isActive?0>y&&F():A.request(c)):0>y&&(c.style.display="none",d.style.display="none",F())},this.feed=function(a,b,c){z&&s[y].samples.push({ts:a,x:b,y:c})},this.isActive=function(){return z};var D=function(){c=document.createElement("div"),c.className="gt-calibVerifier-container",c.classList.add(t.className.container),d=document.createElement("div"),d.className="gt-calibVerifier-target",d.classList.add(t.className.target),d.style.width=t.size+"px",d.style.height=t.size+"px",d.style.borderRadius=t.size/2+"px",e=document.createElement("div"),e.className="gt-calibVerifier-pulsator",e.classList.add(t.className.pulsator),f=document.createElement("canvas"),f.width=q.width,f.height=q.height,f.className="gt-calibVerifier-canvas",f.addEventListener("click",R),f.addEventListener("keyup",R),h=document.createElement("div"),h.className="gt-calibVerifier-rating";for(var a=["Amplitude","Uniformity"],b=0;2>b;++b){if(b>0){var j=document.createElement("div");j.className="spacer",h.appendChild(j)}var k=document.createElement("span");k.textContent=a[b],h.appendChild(k);for(var l=0;5>l;++l){var m=document.createElement("div");m.className="star empty",h.appendChild(m)}}i=document.createElement("div"),i.className="close",i.addEventListener("click",R),c.appendChild(f),c.appendChild(e),c.appendChild(d),c.appendChild(h),c.appendChild(i),document.body.appendChild(c),g=f.getContext("2d")},E=function(){s=[];for(var a=0;a<t.rows;a++)for(var b=0;b<t.columns;b++)s.push({location:{x:(b+.5)/t.columns,y:(a+.5)/t.rows},cell:{row:a,col:b},samples:[]});for(a=0;a<3*s.length;a++){var c=r.getRandomInt(s.length-1),d=r.getRandomInt(s.length-1),e=s[c];s[c]=s[d],s[d]=e}},F=function(){r.debug("CalibrationVerifier","starting the verification"),o=0,n=Math.floor(t.transitionDuration/u)+1,G()},G=function(){if(z=!1,e.style.display="none",clearInterval(x),x=0,y>=0&&j.targetFinished){r.debug("CalibrationVerifier","collected "+m.samples.length+" samples");var a=y+1===s.length?null:s[y+1];a&&(a={location:r.clone(a.location),cell:r.clone(a.cell)}),j.targetFinished(m,a)}if(y++,0===y&&j.started){var b=s[0],a={location:r.clone(b.location),cell:r.clone(b.cell)};j.started(a)}y<s.length?(r.debug("CalibrationVerifier","target #"+y),t.transitionDuration>0?(r.debug("CalibrationVerifier","animating"),l=0===y?{x:0,y:0}:m.location,m=s[y],setTimeout(H,u)):(m=s[y],J())):(t.displayResults&&(k=setTimeout(R,1e3*t.displayResults)),y=-1,M())},H=function(){if(o++,n>o){var a=(m.location.x-l.x)/n,b=(m.location.y-l.y)/n;I(l.x+a*o,l.y+b*o),setTimeout(H,u)}else o=0,J()},I=function(a,b){d.style.left=Math.round(a*q.width)-t.size/2+"px",d.style.top=Math.round(b*q.height)-t.size/2+"px"},J=function(){r.debug("CalibrationVerifier","target is displaying");var a=s[y];if(I(a.location.x,a.location.y),setTimeout(K,v),setTimeout(G,t.duration),j.targetStarted){var b={location:r.clone(a.location),cell:r.clone(a.cell)};j.targetStarted(b)}},K=function(){t.pulsation.enabled&&(L(),e.style.display="block",p=(new Date).getTime(),x=setInterval(L,w)),z=!0},L=function(){var a=(new Date).getTime()-p,b=Math.PI*(a/t.pulsation.duration%1),c=Math.sin(b)*t.pulsation.size,d=s[y];e.style.left=Math.round(d.location.x*q.width)-t.size/2-c+"px",e.style.top=Math.round(d.location.y*q.height)-t.size/2-c+"px",e.style.width=t.size+2*c+"px",e.style.height=t.size+2*c+"px",e.style.borderRadius=(t.size+2*c)/2+"px"},M=function(){r.debug("CalibrationVerifier","reporting results");var a,b;d.style.display="none",f.style.display="block",h.style.display="block",i.style.display="block",g.clearRect(0,0,q.width,q.height),g.font="16pt Arial";var c={amplitude:{mean:0,std:0},angle:{mean:{sin:0,cos:0},std:0},std:{mean:0,std:0},targets:[],apx:{},interpretation:[]},e=Array.apply(null,new Array(t.columns)).map(function(){return 0}),k=Array.apply(null,new Array(t.rows)).map(function(){return 0});for(a=0,b=s.length;b>a;++a){var l=s[a],m={x:l.location.x*q.width,y:l.location.y*q.height};g.fillStyle=t.resultColors.target,g.beginPath(),g.arc(Math.round(m.x),Math.round(m.y),t.size/2,0,2*Math.PI),g.fill();var n=N(l.samples,m);n&&(n.location=m,n.cell=l.cell,c.targets.push(n),c.amplitude.mean+=n.amplitude.abs,c.angle.mean.sin+=Math.sin(n.angle),c.angle.mean.cos+=Math.cos(n.angle),c.std.mean+=n.std,e[l.cell.col]+=n.amplitude.h,k[l.cell.row]+=n.amplitude.v,g.fillStyle=t.resultColors.offset,g.beginPath(),g.arc(Math.round(m.x+n.amplitude.abs*Math.cos(n.angle)),Math.round(m.y+n.amplitude.abs*Math.sin(n.angle)),n.std,0,2*Math.PI),g.fill())}if(c.targets.length>0){for(c.amplitude.mean/=c.targets.length,c.angle.mean.sin/=c.targets.length,c.angle.mean.cos/=c.targets.length,c.std.mean/=c.targets.length,a=0,b=c.targets.length;b>a;++a){var o=c.targets[a];c.amplitude.std+=Math.pow(o.amplitude.abs-c.amplitude.mean,2),c.std.std+=Math.pow(o.std-c.std.mean,2)}c.amplitude.std=Math.sqrt(c.amplitude.std/(b-1)),c.std.std=Math.sqrt(c.std.std/(b-1)),c.angle.std=Math.sqrt(Math.pow(c.angle.mean.sin,2)+Math.pow(c.angle.mean.cos,2)),c.angle.mean=Math.atan2(c.angle.mean.sin,c.angle.mean.cos),e=e.map(function(a,b){return{x:(2*b+1)/t.columns-1,y:a/t.rows}}),k=k.map(function(a,b){return{x:(2*b+1)/t.rows-1,y:a/t.columns}}),c.apx={h:O(e,2),v:O(k,2)};var p=!(!c.apx.h||!c.apx.v);if(p){var u=P(c.apx.h,["left","right"]),v=P(c.apx.v,["top","bottom"]);c.interpretation=Q(u,v,c.amplitude),g.fillStyle=t.resultColors.text,g.fillText(c.interpretation.text[1],10,q.height-50),g.fillText(c.interpretation.text[0],10,q.height-25);var w=h.querySelectorAll(".star");for(a=0,b=w.length;b>a;++a){var x=w[a],y=5>a?c.interpretation.rating.amplitude:c.interpretation.rating.uniformity,z=y/2-a%5;x.className=z>.75?"star full":z>.25?"star half":"star empty"}}}j.finished&&j.finished(c)},N=function(a,b){var c,d,e,f={x:0,y:0},h=null;for(g.fillStyle=t.resultColors.sample,d=0,e=a.length;e>d;++d)c=a[d],f.x+=c.x-b.x,f.y+=c.y-b.y,g.beginPath(),g.arc(Math.round(c.x),Math.round(c.y),2,0,2*Math.PI),g.fill();if(a.length>1){f.x/=a.length,f.y/=a.length;var i=Math.sqrt(f.x*f.x+f.y*f.y),j=Math.atan2(f.y,f.x),k=0,l={x:b.x+f.x,y:b.y+f.y};for(d=0,e=a.length;e>d;++d){c=a[d];var m=c.x-l.x,n=c.y-l.y;k+=m*m+n*n}k=Math.sqrt(k/(e-1)),h={amplitude:{h:Math.abs(f.x),v:Math.abs(f.y),abs:i},angle:j,std:k}}return h},O=function(a,b){var c,d,e,f=a.length;if(b+1>f)return null;var g=new Array(b+1),h=new Array(b+1),i=new Array(f),j=new Array(f),k=new Array(b+1);for(e=0;f>e;++e){var l=a[e];i[e]=l.x,j[e]=l.y}for(c=0;b>=c;++c)for(g[c]=0,h[c]=0,k[c]=new Array(b+1),d=0;b>=d;++d)for(k[c][d]=0,e=0;f>e;++e)k[c][d]+=Math.pow(i[e],c+d);for(c=0;b>=c;++c)for(e=0;f>e;++e)h[c]+=Math.pow(i[e],c)*j[e];var m=0;for(c=0;b>=c;++c)if(0===k[c][c])for(d=0;b>=d;++d)if(d!==c&&0!==k[d][c]&&0!==k[c][d]){for(e=0;b>=e;++e)m=k[d][e],k[d][e]=k[c][e],k[c][e]=m;m=h[d],h[d]=h[c],h[c]=m;break}for(e=0;b>=e;++e)for(c=e+1;b>=c;++c){if(0===k[e][e])return null;var n=k[c][e]/k[e][e];for(d=e;b>=d;++d)k[c][d]-=n*k[e][d];h[c]-=n*h[e]}for(c=b;c>=0;--c){var o=0;for(d=c;b>=d;++d)o+=k[c][d]*g[d];g[c]=(h[c]-o)/k[c][c]}return g},P=function(a,b){var c=function(a,b){for(var c=0,d=0,e=a.length;e>d;++d)c+=a[d]*Math.pow(b,d);return c},d=t.interpretationThreshold,e=[c(a,-1),c(a,0),c(a,1)],f=[(e[0]-e[1])/d,(e[2]-e[1])/d,(e[0]-e[2])/d],g=-1,h=0,i=1,j=function(a){var b=h;return-1>=a?b=g:a>=1&&(b=i),b};f=f.map(j);var k,l=0,m=1,n=2,o=[Number.NaN,Number.NaN,Number.NaN],p={muchWorse:-2,worse:-1,equal:0,better:1,muchBetter:2},q={flat:"flat",lowGradient:"low gradient",highGradient:"high gradient",side:"high side",lowCone:"low cone",highCone:"high cone"};f[0]===g&&f[1]===g?(o[m]=p.muchWorse,k=q.highCone):f[0]===i&&f[1]===i?(o[m]=p.muchBetter,k=q.highCone):f[0]===g&&f[1]===h&&f[2]===g?(o[l]=p.muchBetter,k=q.side):f[0]===g&&f[1]===h&&f[2]===h?(o[l]=p.better,o[m]=p.worse,k=q.lowCone):f[0]===g&&f[1]===i&&f[2]===g?(o[l]=p.better,o[n]=p.worse,k=q.highGradient):f[0]===h&&f[1]===g&&f[2]===h?(o[n]=p.better,o[m]=p.worse,k=q.lowCone):f[0]===h&&f[1]===g&&f[2]===i?(o[n]=p.muchBetter,k=q.side):f[0]===h&&f[1]===h&&f[2]===g?(o[l]=p.better,k=q.lowGradient):f[0]===h&&f[1]===h&&f[2]===h?(o[m]=p.equal,k=q.flat):f[0]===h&&f[1]===h&&f[2]===i?(o[n]=p.better,k=q.lowGradient):f[0]===h&&f[1]===i&&f[2]===g?(o[n]=p.muchWorse,k=q.side):f[0]===h&&f[1]===i&&f[2]===h?(o[n]=p.worse,o[m]=p.better,k=q.lowCone):f[0]===i&&f[1]===g&&f[2]===i?(o[l]=p.worse,o[n]=p.better,k=q.highGradient):f[0]===i&&f[1]===h&&f[2]===h?(o[l]=p.worse,o[m]=p.better,k=q.lowCone):f[0]===i&&f[1]===h&&f[2]===i&&(o[l]=p.muchWorse,k=q.side);var r=["much worse","worse","","better","much better"],s=" at ",u=" to ",v="gradually worsening from ",w=[];return isNaN(o[m])?isNaN(o[l])?isNaN(o[n])||w.push(r[o[n]+2]+s+b[1]):isNaN(o[n])?w.push(r[o[l]+2]+s+b[0]):o[l]>o[n]?w.push(v+b[0]+u+b[1]):w.push(v+b[1]+u+b[0]):(isNaN(o[l])?isNaN(o[n])||w.push(r[o[n]+2]+s+b[1]):w.push(r[o[l]+2]+s+b[0]),0!==o[m]?w.push(r[o[m]+2]+s+"center"):w.push("about equal")),{text:w,type:k}},Q=function(a,b,c){var d,e=[],f=[];a.text.length?e.push(a.text.join(", ")+" in the horizontal dimension"):f.push(" horizontal"),b.text.length?e.push(b.text.join(", ")+" in the vertical dimension"):f.push(" vertical"),e.length>0&&(d=e.join(", "),e=["Interpretation: calibration is ",d,"."]),f.length>0&&(d=f.join(" and "),f=["Cannot interpretate results for the ",d," dimension."]);var c=10-Math.floor(2*c.mean/t.interpretationThreshold),g=function(a,b){return new RegExp(a).test(b)},h=10;h-=g("gradient|cone|side",a.type)?2:0,h-=g("gradient|cone|side",b.type)?2:0,h-=g("high",a.type)?2:0,h-=g("high",b.type)?2:0;var i={text:[e.join(""),f.join("")],rating:{amplitude:Math.max(1,c),uniformity:Math.max(1,h)}};return i},R=function(){c.style.display="none",A.exit(),k&&(clearTimeout(k),k=0)}}a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.CalibrationVerifier=b}(window),function(a){"use strict";function b(a,b,c){this.ec=b||{xl:0,yl:0,xr:0,yr:0},this.timestamp=a||-1,this.focused=c||null}function c(a,b,c,d){this.xl=a||0,this.yl=b||0,this.xr=c||0,this.yr=d||0}function d(a,b){this.left=a||0,this.right=b||0}function e(a,b){var e=b,f=null,g=.3,h=.8,i=2e3,j=[],k=[],l=null,m=0,n=!1,o=!0,p=null,q=0,r=0,s=null,t=new c,u=a.trials,v=document.createElement("div");v.id="gt-chgd-calibOverlay",v.innerHTML='            <div id="gt-chgd-calib">                <a id="gt-chgd-calibClose" href="#">X</button>            </div>',document.body.insertBefore(v,document.body.firstChild);var w=this;document.getElementById("gt-chgd-calibClose").addEventListener("click",function(){return w.hide(!0),!1});var x=document.createElement("canvas");x.id="gt-chgd-calibCanvas",x.width=Math.round(320*a.plotSizeFactor),x.height=Math.round(240*a.plotSizeFactor),document.getElementById("gt-chgd-calib").appendChild(x);var y=x.getContext("2d"),z=function(b,c,d,e,f){for(var g=-1,h=a.threshold,i=b[c],j=d;f>0?e>j:j>=e;j+=f){var k=b[j],l=k.ec.xl-i.ec.xl,m=k.ec.yl-i.ec.yl,n=k.ec.xr-i.ec.xr,o=k.ec.yr-i.ec.yr,p=Math.sqrt(l*l+m*m),q=Math.sqrt(n*n+o*o);if(p>h||q>h){g=j;break}}return g},A=function(){return Math.max(5,q-Math.max(2*r,.2*q))},B=function(){return Math.max(10,q+Math.max(2*r,.2*q))},C=function(a,b,d){var e=new c;if(d>b){for(var f=b;d>=f;f+=1){var g=a[f];e.xl+=g.ec.xl,e.yl+=g.ec.yl,e.xr+=g.ec.xr,e.yr+=g.ec.yr}var h=d-b+1;e.xl/=h,e.yl/=h,e.xr/=h,e.yr/=h}return e},D=function(a,b,c,d){if(c>b)for(var e=b;c>=e;e+=1){var f=a[e];f.ec.xl-=d.xl,f.ec.yl-=d.yl,f.ec.xr-=d.xr,f.ec.yr-=d.yr}},E=function(a,b,e,f){var g={error:new d,correl:new d};if(e>b){for(var h=new d,i=new d,j=new d,k=new d,l=new d,m=b;e>=m;m+=1){var n=Math.round((m-b)/(e-b)*(s.length-1)),o=s[n],p=a[m],q=new c(p.ec.xl-f.xl,p.ec.yl-f.yl,p.ec.xr-f.xr,p.ec.yr-f.yr);g.error.left+=Math.sqrt(Math.pow(q.xl-o.xl,2)+Math.pow(q.yl-o.yl,2)),g.error.right+=Math.sqrt(Math.pow(q.xr-o.xr,2)+Math.pow(q.yr-o.yr,2));var r=new d(Math.sqrt(Math.pow(q.xl,2)+Math.pow(q.yl,2)),Math.sqrt(Math.pow(q.xr,2)+Math.pow(q.yr,2))),u=new d(Math.sqrt(Math.pow(o.xl,2)+Math.pow(o.yl,2)),Math.sqrt(Math.pow(o.xr,2)+Math.pow(o.yr,2)));h.left+=r.left*u.left,i.left+=r.left,j.left+=u.left,k.left+=Math.pow(r.left,2),l.left+=Math.pow(u.left,2),h.right+=r.right*u.right,i.right+=r.right,j.right+=u.right,k.right+=Math.pow(r.right,2),l.right+=Math.pow(u.right,2)}var v=new d(Math.sqrt(Math.pow(t.xl,2)+Math.pow(t.yl,2)),Math.sqrt(Math.pow(t.xr,2)+Math.pow(t.yr,2))),w=e-b+1;g.error.left=g.error.left/w/v.left,g.error.right=g.error.right/w/v.right;try{g.correl.left+=(w*h.left-i.left*j.left)/Math.sqrt(w*k.left-Math.pow(i.left,2))/Math.sqrt(w*l.left-Math.pow(j.left,2)),g.correl.right+=(w*h.right-i.right*j.right)/Math.sqrt(w*k.right-Math.pow(i.right,2))/Math.sqrt(w*l.right-Math.pow(j.right,2))}catch(x){}}return g},F=function(a,b,c,d,e){if(c>b)for(var f=b;c>=f;f++){var g=Math.round((f-b)/(c-b)*(s.length-1)),h=s[g],i=a[f];h.xl=(1-e)*h.xl+e*(i.ec.xl-d.xl),h.yl=(1-e)*h.yl+e*(i.ec.yl-d.yl),h.xr=(1-e)*h.xr+e*(i.ec.xr-d.xr),h.yr=(1-e)*h.yr+e*(i.ec.yr-d.yr)}},G=function(){for(var a=0;a<j.length;a+=1){var b=j[a];b.length<2&&(j.splice(a,1),a-=1)}},H=function(a,b){for(var c=0,d=0,e=0;e<a.length;e+=1)a[e]!=b&&(c+=a[e],d+=1);return d?c/d:0},I=function(a,b,c){for(var d=0,e=0,f=0;f<a.length;f+=1)a[f]!=c&&(d+=Math.pow(a[f]-b,2),e+=1);return e?Math.sqrt(d/e):0},J=function(a){for(var b=Number.MIN_VALUE,d=Number.MAX_VALUE,e=Number.MIN_VALUE,f=Number.MAX_VALUE,g=Number.MIN_VALUE,h=Number.MAX_VALUE,i=Number.MIN_VALUE,j=Number.MAX_VALUE,k=0;k<a.length;k+=1){var l=a[k];b<l.xl&&(b=l.xl),d>l.xl&&(d=l.xl),e<l.yl&&(e=l.yl),f>l.yl&&(f=l.yl),g<l.xr&&(g=l.xr),h>l.xr&&(h=l.xr),i<l.yr&&(i=l.yr),j>l.yr&&(j=l.yr)}return new c(b-d,e-f,g-h,i-j)},K=function(a,b){var d=[];q=H(a,0),r=I(a,q,0);var e,f,g,h,i=(new c,Math.round(q));for(e=0;i>e;e+=1){var k=e/(i-1),l=new c,m=0;for(f=0;f<j.length;f+=1)a[f]&&(g=b[f]+Math.round(k*a[f]),h=j[f][g],l.xl+=h.ec.xl,l.yl+=h.ec.yl,l.xr+=h.ec.xr,l.yr+=h.ec.yr,m+=1);m&&(l.xl/=m,l.yl/=m,l.xr/=m,l.yr/=m),d.push(l)}return d},L=function(){var b,c,d=[],e=[],f=0,g=a.threshold;for(b=0;b<j.length;b+=1){var h=j[b];d[b]=z(h,0,1,h.length,1),c=z(h,h.length-1,h.length-2,0,-1);var i=d[b]<0?h.length-1:d[b]-1,k=C(h,0,i),l=0>c?0:c+1,m=C(h,l,h.length-1);D(h,0,h.length-1,k);var n=Math.sqrt(Math.pow(k.xl-m.xl,2)+Math.pow(k.yl-m.yl,2)),o=Math.sqrt(Math.pow(k.xr-m.xr,2)+Math.pow(k.yr-m.yr,2));d[b]>=0&&c>=0&&d[b]<c&&g>n&&g>o?e.push(c-d[b]+1):(e.push(0),f++)}return{startIndexes:d,durations:e,zeroSignalSizeCount:f}},M=function(){if(!(j.length<u)){G();var a=L(),b=a.zeroSignalSizeCount<j.length/2;b&&(s=K(a.durations,a.startIndexes),t=J(s))}},N=function(){y.fillStyle="white",y.fillRect(0,0,x.width,x.height),k.length>0&&O(k)},O=function(a){var b=x.width,c=x.height,d=24;y.font=d+"px Arial",y.textAlign="center",y.textBaseline="middle",y.fillStyle="#444",a.forEach(function(e,f){y.fillText(e,Math.round(b/2),Math.round(c/2)+1.5*d*(f-(a.length-1)/2))})},P=function(a){var b=x.width,c=x.height,d=function(d){y.beginPath();for(var e=0;e<a.length;e+=1){var f=a[e];0===e?y.moveTo(f.ec["x"+d]*b,f.ec["y"+d]*c):y.lineTo(f.ec["x"+d]*b,f.ec["y"+d]*c)}y.stroke()};y.strokeStyle="black",y.lineWidth=2,a&&(d("l"),d("r"))},Q=function(a){var b=x.width,c=x.height;y.fillStyle="red",y.beginPath(),y.arc(a.ec.xl*b,a.ec.yl*c,3,0,2*Math.PI),y.arc(a.ec.xr*b,a.ec.yr*c,3,0,2*Math.PI),y.fill()},R=function(){n=!1},S=function(b){p=null;var c=0;m+=1,2*u>m?m%2===1?(l=[],j.push(l),c=a.trialDuration,k=[],f&&f("start")):(l=null,c=a.pauseDuration,k=["Gesture recorded","Prepare for the next"],f&&f("stop")):m===2*u?(l=null,c=1e3,k=[],f&&f("stop")):m===2*u+1?(k=["Processing data","Please wait..."],N(),f&&f("processing"),M(),c=2e3,k=["Done!"],f&&f("processed")):m===2*(u+1)&&(k=[],b.hide(!0),f&&f("finished")),N(),c&&(p=setTimeout(S,c,b))};this.getBufferSize=function(){return q+4*r+20},this.init=function(a){f=a,j=[],s=null,l=null,m=0,n=!1,o=!0,this.show(),p=setTimeout(S,i+1500,this),k=["Task: "+u+" head gesture"+(u>1?"s":""),"Prepare for the first gesture"],N()},this.finilize=function(){l=null},this.detect=function(a,b){var c={detected:!1};if(!s)return c;var e,f=z(a,0,1,a.length-1,1),i=z(a,a.length-1,a.length-1,0,-1),j={error:new d,correl:new d},k=i-f+1;return f>0&&i>0&&i>f&&k>A()&&k<B()&&(c.detected=!0,e=C(a,0,f-1),j=E(a,f,i,e),(j.error.left>g||j.error.right>g||j.correl.left<h||j.correl.right<h)&&(c.detected=!1,o=!0),c.detected&&b&&o&&f>10&&i<a.length-1&&(F(a,f,i,e,.3),o=!1)),c.detected&&(c.detected=a[f-1].focused),c.detected&&!n&&(n=!0,setTimeout(R,1e3)),c},this.feed=function(a){l&&l.push(a),N(),0===k.length&&(P(l),Q(a))},this.show=function(){v.style.display="block"},this.hide=function(a){v.style.display="none",p&&(clearTimeout(p),p=null),a&&e&&e()}}b.prototype.isSet=function(){return!(0===this.ec.xl&&0===this.ec.yl&&0===this.ec.xr&&0===this.ec.yr)},b.prototype.isValid=function(){return-1!==this.timestamp},e.createUI=function(a,b,c){var d=document.getElementById(a.menu);d||(d=document.createElement("div"),d.id=a.menu,document.body.appendChild(d)),d.innerHTML='<ul><li><a href="#">Calibrate gesture</a></li></ul>';var e=document.createElement("ul");e.id=a.list,d.firstChild.firstChild.appendChild(e);for(var f in b){var g=(b[f],document.createElement("li")),h=document.createElement("input");h.type="button",h.value=f.charAt(0).toUpperCase()+f.slice(1),c(h,f),g.appendChild(h),e.appendChild(g)}e.hasChildNodes()&&(d.style.display="inline-box")},a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.CustomHeadGestureCalibrator=e}(window),function(a){"use strict";var b,c,d={init:function(d){b=d||{},c=a.GazeTargets.Utils,c.bool(b.show)&&k()},setLabel:function(a){f&&(f.innerHTML=a)},setIsConnected:function(a){e&&(a?e.classList.add(b.connectedClassName):e.classList.remove(b.connectedClassName))},update:function(a){e&&(a.device&&(f.innerHTML=a.device),g.disabled=!a.isServiceRunning||a.isTracking||a.isBusy,h.disabled=!a.isConnected||a.isTracking||a.isBusy,i.disabled=!a.isCalibrated||a.isBusy,i.value=a.isTracking?"Stop":"Start",!a.isTracking&&a.isCalibrated&&(j.innerHTML=""))},printData:function(a){if(e&&c.bool(b.displaySamples)){var d=function(a,b){for(var c=a+",";c.length<b;)c+=" ";return c},f=ropot.GazeTargets.Utils.screenToClient(a.x,a.y),g="t = "+d(a.ts,6)+" x = "+d(f.x,5)+" y = "+d(f.y,5)+" p = "+d(a.pupil,4);if(void 0!==a.ec){g+="ec: { ";var h;for(h in a.ec)g+=h+" = "+a.ec[h]+", ";g+="}"}j.innerHTML=g}}},e=null,f=null,g=null,h=null,i=null,j=null,k=function(){var c='\n            <span id="gt-etudpanel-device"></span>\n            <input id="gt-etudpanel-showOptions" type="button" value="Options" disabled />\n            <input id="gt-etudpanel-calibrate" type="button" value="Calibrate" disabled />\n            <input id="gt-etudpanel-toggleTracking" type="button" value="Start" disabled />\n            <span id="gt-chgd-calibMenu"></span>\n            <span id="gt-etudpanel-log"></span>\n            ';e=document.createElement("div"),e.id=b.id,e.innerHTML=c;var d=window.getComputedStyle(document.body).paddingTop;document.body.insertBefore(e,document.body.firstChild),document.body.style.margin="0px",-1===navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){document.body.style.paddingTop=Math.max(parseInt(d,10),e.scrollHeight)+"px"},100),f=document.getElementById("gt-etudpanel-device"),g=document.getElementById("gt-etudpanel-showOptions"),h=document.getElementById("gt-etudpanel-calibrate"),i=document.getElementById("gt-etudpanel-toggleTracking"),j=document.getElementById("gt-etudpanel-log"),g.addEventListener("click",function(){a.GazeTargets.ETUDriver.showOptions()}),h.addEventListener("click",function(){a.GazeTargets.ETUDriver.calibrate()}),i.addEventListener("click",function(){a.GazeTargets.ETUDriver.toggleTracking()})};a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.ETUDPanel=d}(window),function(a){"use strict";var b,c,d,e,f={init:function(f,h,i){b=f,k=h,c=i,d=a.GazeTargets.Utils,e=a.GazeTargets.ETUDPanel,c.device&&(m=d.getStoredValue(c.device)),e.setLabel(g.connecting);var j="ws://localhost:"+b.port+"/";l=new WebSocket(j),l.onopen=v,l.onclose=w,l.onmessage=x,l.onerror=y},showOptions:function(a){q=a,u(h.showOptions)},calibrate:function(a){q=a,u(h.calibrate)},toggleTracking:function(){u(h.toggleTracking)},getState:function(){var a=z();return{isServiceRunning:a.isServiceRunning,isConnected:a.isConnected,isCalibrated:a.isCalibrated,isTracking:a.isTracking,device:a.device}}},g={disconnected:"DISCONNECTED",connecting:"CONNECTING...",connected:"CONNECTED"},h={showOptions:"SHOW_OPTIONS",calibrate:"CALIBRATE",toggleTracking:"TOGGLE_TRACKING",setDevice:"SET_DEVICE"},i={sample:"sample",state:"state",device:"device"},j={none:0,connected:1,calibrated:2,tracking:4,busy:8},k={data:function(){},state:function(){}},l=null,m="",n=j.none,o="",p=0,q=null,r=[],s=0,t=0,u=function(a){d.debug("ETUDriver.send","WebSocket sent: "+a),l.send(a)},v=function(){var a=z(j.none);e.setLabel(g.connected),e.setIsConnected(!0),e.update(a),m&&u(h.setDevice+" "+m)},w=function(){l=null,o="";var a=z(j.none);e.setLabel(g.disconnected),e.setIsConnected(!1),e.update(a)},x=function(a){var b,f=JSON.parse(a.data);f.type===i.sample?(p?r.push({ts:f.ts,x:f.x,y:f.y,pupil:f.p,ec:f.ec}):k.data&&k.data(f.ts,f.x,f.y,f.p,f.ec),e.printData(f)):f.type===i.state?(d.debug("onWebSocketMessage","WebSocket got state: "+a.data),b=z(f.value),A(b)):f.type===i.device&&(d.debug("onWebSocketMessage","WebSocket got device: "+a.data),c.device&&d.store(c.device,f.name),b=z(void 0,f.name),A(b))},y=function(a){d.debug("onWebSocketError",a),lblLog&&(lblLog.innerHTML="Problems in the connection to WebSocket server",setTimeout(function(){lblLog.innerHTML=""},5e3))},z=function(a,b){var c=!1;return void 0!==a?(c=(n&j.tracking)>0&&0===(a&j.tracking),n=a):a=n,void 0!==b?o=b:b=o,{isServiceRunning:!!l,isConnected:(n&j.connected)>0,isCalibrated:(n&j.calibrated)>0,isTracking:(n&j.tracking)>0,isBusy:(n&j.busy)>0,isStopped:c,device:o}},A=function(a){d.updatePixelConverter(),e.update(a),a.isTracking?b.frequency>=10&&b.frequency<=100&&(p=setTimeout(B,1e3/b.frequency),t=(new Date).getTime(),s=0):p&&(clearTimeout(p),p=0),q&&(q(a.isCalibrated),q=null),k.state&&k.state(a)},B=function(){s+=1;var a=null;if(r.length){for(var c=0,d=0,e=0,f={xl:0,yl:0,xr:0,yr:0},g=0;g<r.length;g+=1){var h=r[g];c+=h.x,d+=h.y,e+=h.pupil,h.ec&&(f.xl+=h.ec.xl,f.yl+=h.ec.yl,f.xr+=h.ec.xr,f.yr+=h.ec.yr)}a={ts:Math.round(s*(1e3/b.frequency)),x:c/r.length,y:d/r.length,pupil:e/r.length,ec:{xl:f.xl/r.length,yl:f.yl/r.length,xr:f.xr/r.length,yr:f.yr/r.length}},r=[]}else lastSample&&(a=lastSample);a&&ondata(a.ts,a.x,a.y,a.pupil,a.ec);var i=(new Date).getTime(),j=Math.round(t+(s+1)*(1e3/b.frequency)),k=Math.max(0,j-i);p=setTimeout(B,k)};a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.ETUDriver=f}(window),function(a){"use strict";function b(a,b,c){this.ts=a,this.x=b,this.y=c,this.duration=0,this.saccade={dx:0,dy:0},this.samples=[]}function c(a){this.currentFix=null;var c=null;this.feed=function(d,e,f){var g=!1;if(this.currentFix)if(c){var h=this.currentFix.x-e,i=this.currentFix.y-f,j=Math.sqrt(h*h+i*i),k=c.x-e,l=c.y-f,m=Math.sqrt(k*k+l*l);j<a.maxFixSize?this.currentFix.addSample(a.bufferLength,d,e,f):m<a.maxFixSize?(this.currentFix=c,c=null,this.currentFix.addSample(a.bufferLength,d,e,f),g=!0):(c=new b(d,e,f),c.saccade.dx=e-this.currentFix.x,c.saccade.dy=f-this.currentFix.y)}else{var n=this.currentFix.x-e,o=this.currentFix.y-f,p=Math.sqrt(n*n+o*o);p<a.maxFixSize?this.currentFix.addSample(a.bufferLength,d,e,f):(c=new b(d,e,f),c.saccade.dx=e-this.currentFix.x,c.saccade.dy=f-this.currentFix.y)}else this.currentFix=new b(d,e,f),g=!0;return g},this.reset=function(){this.currentFix=null,c=null}}b.prototype.addSample=function(a,b,c,d){this.samples.length==a&&this.samples.shift(),this.samples.push({x:c,y:d}),this.duration=b-this.ts;for(var e=0,f=0,g=0;g<this.samples.length;g+=1){var h=this.samples[g];e+=h.x,f+=h.y}this.x=e/this.samples.length,this.y=f/this.samples.length},a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.FixationDetector=c}(window),function(a){"use strict";function b(){}b.prototype.request=function(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},b.prototype.exit=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen){var a=document.mozFullScreenElement,b=a.parentNode;b.removeChild(a),b.appendChild(a)}else document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},Object.defineProperty(b.prototype,"isActive",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||window.fullScreen||document.webkitFullscreenElement||document.msFullscreenElement}}),b.prototype.addEventListener=function(a,b){var c="fullscreen",d=function(a){return Array.prototype.map.apply(a,[function(a,b){return 0===b?a.toUpperCase():a}]).join("")};document.addEventListener(c+a,b),document.addEventListener("webkit"+c+a,b),document.addEventListener("moz"+c+a,b),document.addEventListener("MS"+d(c)+d(a),b)},a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.FullScreen=b}(window),function(a){"use strict";function b(a){var b=null,c=function(a){var b=0,c=0,d=0;return a.xl&&(c+=a.xl,d+=a.yl,b+=1),a.xr&&(c+=a.xr,d+=a.yr,b+=1),b&&(c/=b,d/=b),{x:c,y:d}};this.init=function(a){b=c(a)},this.correct=function(d,e){var f=c(e),g=(f.x-b.x)*a.transformParam,h=(f.y-b.y)*a.transformParam;return{x:Math.round(d.x-g),y:Math.round(d.y+h)}}}a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.HeadCorrector=b}(window),function(a){"use strict";function b(a,b,c,d,e){this.matched=0,this.ts=a,this.x=b,this.y=c,this.ec=d,this.focused=e}function c(a,b){this.settings=b,this.rules=a,this.buffer=[],this.eventIsOn=!1,this.canTest=!1,this.current=null}b.prototype.isMatched=function(a){var b=1<<a;return(this.matched&b)>0},b.prototype.setMatched=function(a,b){var c=~(1<<a);this.matched=(this.matched&c)+(b?1<<a:0)},c.prototype.init=function(){this.buffer=[],this.eventIsOn=!1,this.canTest=!1,this.current=null},c.prototype.feed=function(a,c,d,e,f){var g=null;if(e){for(var h=0;h<this.buffer.length&&a-this.buffer[h].ts>this.settings.timeWindow;h++)this.buffer.shift(),this.canTest=!0;this.canTest=this.canTest&&this.buffer.length>0;var i=new b(a,c,d,e,f);this.canTest&&this.test(i),this.buffer.push(i),this.canTest&&(g=this.searchPattern())}return this.current=g?g.object:null,g},c.prototype.isRangeTestable=function(a){return 0!==a.min||0!==a.max},c.prototype.normalizeAngles=function(a,b){var c=a.min,d=a.max;return 0===c&&0===d?d=360:c>d&&(180>b?c=0:d=360),{min:c,max:d}},c.prototype.testRule=function(a,b,c,d){var e=!1,f=this.normalizeAngles(a[b].angle,d),g=a[b].amplitude;return e=c>=g.min&&c<=g.max&&d>=f.min&&d<=f.max},c.prototype.test=function(b){var c;for(c=0;c<this.rules.length;c+=1){for(var d=this.rules[c],e=this.buffer.length-1,f=b.ts-d.interval.max,g=b.ts-d.interval.min;e>=0&&this.buffer[e].ts>g;)e-=1;for(var h=d.matchAll;e>=0&&this.buffer[e].ts>f;){var i=this.buffer[e];e-=1;var j=b.ec.xl-i.ec.xl,k=b.ec.yl-i.ec.yl,l=b.ec.xr-i.ec.xr,m=b.ec.yr-i.ec.yr,n=Math.sqrt(j*j+k*k),o=180*Math.atan2(k,j)/Math.PI,p=Math.sqrt(l*l+m*m),q=180*Math.atan2(m,l)/Math.PI;0>o&&(o+=360),0>q&&(q+=360);var r=(this.isRangeTestable(d.left.amplitude)?this.testRule(d,"left",n,o):!0)&&(this.isRangeTestable(d.right.amplitude)?this.testRule(d,"right",p,q):!0);if(d.matchAll){if(h=h&&r,!r)break}else if(h=h||r,r)break}b.setMatched(c,h)}a.GazeTargets.Utils.debug(b.matched)},c.prototype.searchPattern=function(){var a,b=null,c=this.rules.length-1,d=-1,e=0,f=null,g=null;for(a=this.buffer.length-1;a>=0;a-=1){var h=this.buffer[a];if(h.isMatched(c)){if(e>0&&e-h.ts>this.rules[d].interval.max)break;if(c===this.rules.length-1)g=h;else if(0===c){for(var i=h.ts-this.rules[0].interval.max;a>0&&this.buffer[a-1].ts>i;)a-=1;f=this.buffer[a];break}e=h.ts,d=c,c-=1}else d>=0&&h.isMatched(d)&&(e=h.ts)}var j=0,k=0;for(a=0;a<this.rules.length;a+=1){var l=this.rules[a];j+=l.interval.max,k+=l.interval.min}var m=f&&g&&g.ts-f.ts<j&&g.ts-f.ts>k?!0:!1;if(m&&!this.eventIsOn)for(b={name:"nod",object:f.focused};this.buffer.length>0;){var n=this.buffer[0];if(!(n.ts<g.ts))break;this.buffer.shift()}return this.eventIsOn=m,b},c.prototype.computeEyeGazePoints=function(a){for(var b=0,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=Math.max(a,9),l=this.buffer[k].ts,m=l;150>l-m&&k>=0;){var n=this.buffer[k];b+=n.x,c+=n.y,d+=1,n.ec.xl>0&&(e+=n.ec.xl,f+=n.ec.yl,g+=1),n.ec.xr>0&&(h+=n.ec.xr,i+=n.ec.yr,j+=1),m=n.ts,k-=1}return d>0&&(b/=d,c/=d),g>0&&(e/=g,f/=g),j>0&&(h/=j,i/=j),{gaze:{x:b,y:c},eye:{left:{x:e,y:f},right:{x:h,y:i}}}},a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.HeadGestureDetector=c}(window),function(a){"use strict";function b(a,b,c){function d(a){var b=a,c=150,d=150,e=300,f=12,g=20,h=function(a){var h=Math.log((b.dwellTime+d)/e)*f;h+=a,b.dwellTime=Math.round((e*Math.exp(h/f)-d)/g)*g,b.dwellTime<c&&(b.dwellTime=c)};this.increase=function(){h(1)},this.decrease=function(){h(-1)}}this.options=a;var e={};e.layout=a.layout||'["!|!|1,?|?|2,:|:|3,;|;|4,\\u0027|\\u0027|5,\\u0022|\\u0022|6,&|&|7,@|@|8,(|(|9,)|)|0",{"titles":["backspace.png"], "commands":["backspace"]}],\n["q|Q|+,w|W|-:,e|E|*,r|R|\\/,t|T|=,y|Y|%,u|U|$,i|I|#,o|O|(,p|P|)",{"titles":["enter.png"], "commands":["enter"]}],\n["a|A|@,s|S|~,d|D|^,f|F|\\u005C,g|G|_,h|H|&,j|J|[,k|K|],l|L|\\u007B, | |\\u007D",{"titles":["symbols.png","symbols.png","upcase.png"], "commands":["symbols","symbols","upcase"]}],\n["z|Z|,x|X|,c|C|,v|V|,b|B| ,n|N|,m|M|",{"titles":[",","<","<"], "commands":[",","<","<"]},".|>|>",{"titles":["upcase.png","lowcase.png"], "commands":["upcase","lowcase"]},{"titles":["send.png"], "commands":["custom"]}]',e.callbacks=a.callbacks||{},e.imageFolder=a.imageFolder||"/images/kbd/"+a.name+"/",e.className={container:"gt-keyboard "+((a.className?a.className.container:"")||"gt-keyboardDefault"),button:"gt-keyboard-button "+((a.className?a.className.button:"")||"gt-keyboard-buttonDefault")};var f=c||{},g=document.createElement("table");g.className=e.className.container,g.classList.add("gt-keyboard-invisible");var h=0,i={lowcase:0,upcase:1,symbols:2},j={dwell:"dwell"},k=[],l=null,m=new d(a.selection),n=this,o={hide:function(){F()},backspace:function(){var a=l||document.activeElement;if(a){var b=a.selectionStart,c=a.value;if(void 0!==b&&void 0!==c&&b>0){var d=c.substr(0,b-1),e=c.substr(b);a.value=d+e,a.selectionStart=b-1,a.selectionEnd=b-1}}},enter:function(){s("Enter",13)},left:function(){s("Left",37)},right:function(){s("Left",39)},up:function(){s("Up",38)},down:function(){s("Down",40)},home:function(){s("Home",36)},end:function(){s("End",35)},pageup:function(){s("PageUp",33)},pagedown:function(){s("PageDown",34)},dwellInc:function(){m.increase()},dwellDec:function(){m.decrease()},custom:function(a){a in e.callbacks&&e.callbacks[a](n)}},p=function(b){return b===j.dwell?a.selection.dwellTime:void 0},q=function(a,b,c){var d=p(c);d!=a.indicator.value&&(a.indicator.value=d,b.innerHTML=d)},r=function(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return void 0!==b&&null!==b&&c===a},s=function(a,b){function c(a){if("textarea"==a.tagName.toLowerCase()){var b=a.value.substr(0,a.selectionEnd),c=a.value.substr(a.selectionEnd);a.value=b+"\n"+c}else{var d=new KeyboardEvent("keydown",{key:"Enter",code:13,shiftKey:!1});a.dispatchEvent(d)}}function d(a){a.selectionEnd=a.selectionStart=a.value.lastIndexOf("\n",a.selectionEnd-1)+1}function e(a){var b=a.selectionEnd,c=a.value.indexOf("\n",b);
-1===c&&(c=a.value.length),a.selectionStart=a.selectionEnd=c}function f(a){a.selectionStart=a.selectionEnd-=1}function g(a){a.selectionStart=a.selectionEnd+=1}function h(a){var b=a.selectionEnd,c=a.value.lastIndexOf("\n",b),d=a.value.indexOf("\n",b+1);-1!==d&&(b-=c,a.selectionStart=a.selectionEnd=d+b)}function i(a){var b=a.selectionEnd,c=a.value.lastIndexOf("\n",b),d=a.value.lastIndexOf("\n",c-1);-1!==c&&(b-=c,a.selectionStart=a.selectionEnd=d+b)}var j=l||document.activeElement;j&&(13==b?c(j):33==b||34==b||(35==b?e(j):36==b?d(j):37==b?f(j):38==b?i(j):39==b?g(j):40==b&&h(j)))},t=function(a){h=a;var b,c,d;for(b=0;b<k.length;b++)for(d=k[b],c=0;c<d.length;c++)d[c].invalid||(d[c].dom.parentElement.style.display="table-cell");for(b=0;b<k.length;b++)for(d=k[b],c=0;c<d.length;c++)d[c].invalid||d[c].update()},u=function(a){var b=[];try{var c='{"layout": ['+a+"] }",d=JSON.parse(c);if(void 0===d.layout||!r("Array",d.layout))throw'- the JSON object has no "layout" property, or it is not an array';b=d.layout}catch(e){console.log("The definition of layout\n"+a+"\n\nis not valid:\n"+e.message)}return b},v=function(a,b){var c="";return a&&(a.length>b?c=a[b]:a.length>0&&(c=a[0])),c},w=function(a){for(var b=a.split(","),c=[],d=0;d<b.length;d++)c.push(x(b[d]));return c},x=function(a){var b={titles:[],commands:[]};if(r("String",a)){var c,d,e=a.split("|");if(e.length)for(c=0;c<e.length;c++)if(d=e[c]){var f=d.split(":");!f[0]&&f.length>1?(b.titles.push(":"),b.commands.push(f[1]||":")):1==f.length?(b.titles.push(d),b.commands.push(d)):(b.titles.push(f[0]),b.commands.push(f[1]))}else b.titles.push(""),b.commands.push("")}return y(b),b},y=function(a){a.titles=r("Array",a.titles)?a.titles:[],a.commands=r("Array",a.commands)?a.commands:[];var b;if(a.titles.length<a.commands.length)for(b=a.titles.length;b<a.commands.length;b++)a.titles.push(a.commands[b]);else if(a.commands.length<a.titles.length)for(b=a.commands.length;b<a.titles.length;b++)a.commands.push(a.titles[b]);var c="",d="";for(a.titles.length&&(c=a.titles.slice(-1)[0],d=a.commands.slice(-1)[0]),b=a.titles.length;b<Object.keys(i).length;b++)a.titles.push(c),a.commands.push(d);for(b=0;b<a.commands.length;b++){var e=a.commands[b].split(".");e.length>1&&"png"==e[e.length-1].toLowerCase()&&(e.pop(),a.commands[b]=e.join("."))}"undefined"!=typeof a.zoom&&(a.zoom.length||(a.zoom=[a.zoom,a.zoom,a.zoom]))},z=function(){var a=g.insertRow(-1);return a},A=function(a,c){var d=document.createElement("div");d.className=e.className.button,d.classList.add(b.button),d.addEventListener("mousedown",function(a){C(c),a.preventDefault(),a.stopPropagation()},!1);var f=document.createElement("div");d.appendChild(f);var g=a.insertCell(-1);return g.appendChild(d),c?(c.dom=d,c.update=function(){c.indicator&&(clearInterval(c.indicator.timer),c.indicator=null);var a=c?v(c.titles,h):"";d.style.visibility=a.length?"visible":"hidden";var i=c.commands[h],k=i in j;k?d.classList.add(b.indicator):d.classList.remove(b.indicator),f.innerHTML="",f.style.backgroundImage="";var l=a.split(".");l.length>1&&"png"==l[l.length-1].toLowerCase()?f.style.backgroundImage="url('"+e.imageFolder+a+"')":k?c.indicator={timer:setInterval(function(){q(c,f,i)},50),value:null}:f.innerHTML=a;var m=c.zoom?Math.round(c.zoom[h]):1;if(g.colSpan=m>1?m:1,m>1)for(var n=g.nextElementSibling;n&&m>1;)n.style.display="none",n=n.nextElementSibling,m-=1},c.update(),void 0):(d.invalid=!0,void 0)},B=function(a){for(;g.hasChildNodes();)g.removeChild(g.lastChild);k=r("Array",a)?a:u(a);var b,c,d,e,f,h=k.length;for(b=0;h>b;b++)for(d=k[b],r("Array",d)||(d=[d],k[b]=d),c=0;c<d.length;c++)f=d[c],r("String",f)?(e=w(f),d.splice.apply(d,[c,1].concat(e)),c+=e.length-1):r("Object",f)&&y(f);for(b=0;h>b;b++)for(d=z(),e=k[b],c=0;c<e.length;c++)A(d,e[c])},C=function(a){D(a.commands[h],a.titles[h])},D=function(a,b){if(a)if(a in o){var c=b,d=c.split(".");d.length>1&&"png"==d[d.length-1].toLowerCase()&&(d.pop(),c=d.join(".")),o[a](c)}else if(a in i)t(i[a]);else{var e=l||document.activeElement;if(e){var f=e.selectionStart,g=e.value;if(void 0!==f&&void 0!==g){var h=g.substr(0,f),j=g.substr(f);e.value=h+a+j,e.selectionStart=f+a.length,e.selectionEnd=f+a.length}}}},E=function(){g.classList.remove("gt-animated"),g.classList.remove("gt-animated-fadeOutDown"),g.classList.add("gt-animated-fadeInUp"),g.classList.add("gt-animated"),f.show&&f.show(n)},F=function(){g.classList.remove("gt-animated"),g.classList.remove("gt-animated-fadeInUp"),g.classList.add("gt-animated-fadeOutDown"),g.classList.add("gt-animated"),f.hide&&f.hide()};this.reset=function(){t(0)},this.show=function(a){if(l=r("String",a)?document.getElementById(a):a,g.classList.remove("gt-keyboard-invisible"),l){var b="gt-keyboard-stickBottom",c=l.getBoundingClientRect(),d=window.innerHeight-c.bottom<g.offsetHeight,f=c.top<g.offsetHeight,h=l.ownerDocument.documentElement,i=h.clientHeight-(l.offsetTop+l.offsetHeight),j=i>g.offsetHeight,k=l.offsetTop>g.offsetHeight,m=null,n=function(){var a=g.getBoundingClientRect();return c.top+c.height-a.top+20},o=function(){return-(g.offsetHeight-c.top)-20};!d||j?d&&(m=n):!f||k?(b="gt-keyboard-stickTop",f&&(m=o)):(g.classList.add(e.className.container+"-shrinked"),m=n),g.classList.add(b);var p=function(){var a=m?m():0;if(a){var b=10,c=20,d=function(){var e=0>a?Math.max(-b,a):Math.min(b,a);a-=e,window.scrollBy(0,e),a&&setTimeout(d,c)};setTimeout(d,c)}g.removeEventListener("animationend",p,!1),g.removeEventListener("webkitAnimationEnd",p,!1)};g.addEventListener("animationend",p,!1),g.addEventListener("webkitAnimationEnd",p,!1),l.focus()}E()},this.hide=function(){F();var a=function(){g.classList.add("gt-keyboard-invisible"),g.classList.remove("gt-keyboard-shrinked"),g.classList.remove("gt-keyboard-stickTop"),g.removeEventListener("animationend",a,!1),g.removeEventListener("webkitAnimationEnd",a,!1)};g.addEventListener("animationend",a,!1),g.addEventListener("webkitAnimationEnd",a,!1)},this.isVisible=function(){return"none"!==g.style.display},this.getDOM=function(){return g},this.getState=function(){return h},this.getInputElem=function(){return l},this.print=function(a,b){D(a,b)},B(e.layout),document.body.appendChild(g)}a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Keyboard=b}(window),function(a){"use strict";function b(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.rel="stylesheet",c.type="text/css",c.href=a,c.media="all",b.appendChild(c)}function c(){var a={dwellProgress:!1,nodDetector:!1,customHeadGestureDetectors:{}};for(var b in k.targets){var c=k.targets[b],d=h(c);m.extend(!0,a,d)}for(var e in j.keyboards){var d=f(e);m.extend(!0,a,d)}switch(k.mapping.type){case j.mapping.types.expanded:m.extend(!0,!0,k.mapping,j.mapping.settings.expanded)}var d=g();return m.extend(!0,a,d),a}function d(b){a.GazeTargets.ETUDPanel.init(k.etudPanel),a.GazeTargets.Pointer.init(k.pointer),u=new j.FixationDetector(k.fixdet),D=new j.CalibrationVerifier(k.calibVerifier),m.bool(k.scroller.enabled)&&(C=new j.Scroller(k.scroller)),m.bool(k.headCorrector.enabled)&&(w=new j.HeadCorrector(k.headCorrector)),m.bool(k.smoother.enabled)&&(x=new j.Smoother(k.smoother)),b.dwellProgress&&(v=j.Progress,v.init(k.progress)),b.nodDetector&&(y=new j.HeadGestureDetector(j.selection.settings.nod,k.headGesture)),e(b.customHeadGestureDetectors)}function e(a){var b=function(a,b){a.addEventListener("click",function(){j.calibrateCustomHeadGesture(b,function(a){})})};for(var c in a)z[c]||(z[c]=new j.CustomHeadGestureDetector(c,k.customHeadGestureDetector));j.CustomHeadGestureCalibrator.createUI(k.customHeadGestureDetector.calibration.ui,z,b)}function f(b){var c=j.keyboards[b];c.selection&&c.selection.type||(c.selection={type:j.selection.types.cumulativeDwell});var d=h(c);return c.name=b,A[b]=new a.GazeTargets.Keyboard(c,p,{hide:function(){l.keyboard&&l.keyboard(B,!1),B=null,j.updateTargets()},show:function(a){B=a,l.keyboard&&l.keyboard(B,!0),j.updateTargets()}}),d}function g(){var a=k.scroller.controller===j.scroller.controllers.fixation?j.scroller.selection:{type:j.selection.types.none},b={className:""},c={};for(var d in j.scroller.types){var e=j.scroller.types[d],f={selector:"."+k.scroller.className+"-"+e,selection:a,mapping:b};k.scroller.targets[e]=f,c=h(f)}return c}function h(a){var b=j.selection,c=j.mapping;switch(a.selection=m.extend(!0,{},b.settings.defaults,a.selection),a.mapping=m.extend(!0,{},c.settings.defaults,a.mapping),a.selection.type){case b.types.cumulativeDwell:m.extend(!0,!0,a.selection,b.settings.cumulativeDwell);break;case b.types.simpleDwell:m.extend(!0,!0,a.selection,b.settings.simpleDwell);break;case b.types.nod:m.extend(!0,!0,a.selection,b.settings.nod)}var d={};if(void 0!==a.selection.dwellTime&&(d.dwellProgress=!0),a.selection.type===b.types.nod&&(d.nodDetector=!0),a.selection.type===b.types.customHeadGesture){var e=a.selection.name||"default";d.customHeadGestureDetectors[e]=!0}return a.selection.audio&&(a.selection.audio=new Audio(E+a.selection.audio)),d}function i(b,c){if(m.bool(k.pointer.show)){var d={x:0,y:0};k.mapping.source==j.mapping.sources.samples?(d.x=c.x,d.y=c.y):k.mapping.source==j.mapping.sources.fixations&&u.currentFix&&(d.x=u.currentFix.x,d.y=u.currentFix.y),x&&(d=x.smooth(b,d.x,d.y)),a.GazeTargets.Pointer.moveTo(d)}else a.GazeTargets.Pointer.show(!1)}var j=a.GazeTargets||(a.GazeTargets={});j.mapping={},j.selection={},j.scroller={},j.keyboard={},j.mapping.types={none:0,naive:1,expanded:2},j.mapping.sources={samples:0,fixations:1},j.mapping.settings={defaults:{className:"gt-focused"},expanded:{expansion:50}},j.selection.types={none:0,cumulativeDwell:1,simpleDwell:2,nod:3,customHeadGesture:4},j.selection.settings={defaults:{className:"gt-selected",duration:200,audio:"sounds/click.wav"},cumulativeDwell:{dwellTime:1e3,showProgress:!0},simpleDwell:{dwellTime:1e3,showProgress:!0},nod:[{matchAll:!0,interval:{min:80,max:120},left:{amplitude:{min:0,max:.005},angle:{min:0,max:0}},right:{amplitude:{min:0,max:.005},angle:{min:0,max:0}}},{matchAll:!1,interval:{min:100,max:200},left:{amplitude:{min:.015,max:.04},angle:{min:70,max:110}},right:{amplitude:{min:.015,max:.04},angle:{min:70,max:110}}},{matchAll:!1,interval:{min:100,max:200},left:{amplitude:{min:.015,max:.04},angle:{min:250,max:290}},right:{amplitude:{min:.015,max:.04},angle:{min:250,max:290}}},{matchAll:!0,interval:{min:80,max:120},left:{amplitude:{min:0,max:.005},angle:{min:0,max:0}},right:{amplitude:{min:0,max:.005},angle:{min:0,max:0}}}]},j.events={focused:"focused",left:"left",selected:"selected"},j.scroller.types=["smooth","page"],j.scroller.controllers={fixation:0,headPose:1},j.scroller.selection={type:j.selection.types.cumulativeDwell,className:"",duration:0,audio:"",dwellTime:800,showProgress:!1},j.keyboards={"default":{layout:'["!|!|1,?|?|2,:|:|3,;|;|4,\\u0027|\\u0027|5,\\u0022|\\u0022|6,&|&|7,@|@|8,(|(|9,)|)|0",{"titles":["backspace.png"], "commands":["backspace"]}],\n["q|Q|+,w|W|-:,e|E|*,r|R|\\/,t|T|=,y|Y|%,u|U|$,i|I|#,o|O|(,p|P|)",{"titles":["enter.png"], "commands":["enter"]}],\n["a|A|@,s|S|~,d|D|^,f|F|\\u005C,g|G|_,h|H|&,j|J|[,k|K|],l|L|\\u007B, | |\\u007D",{"titles":["symbols.png","symbols.png","upcase.png"], "commands":["symbols","symbols","upcase"]}],\n["z|Z|,x|X|,c|C|,v|V|,b|B| ,n|N|,m|M|",{"titles":[",","<","<"], "commands":[",","<","<"]},".|>|>",{"titles":["upcase.png","lowcase.png"], "commands":["upcase","lowcase"]},{"titles":["close.png"], "commands":["hide"]}]',callbacks:{},imageFolder:"images/kbd/default/",className:{container:"gt-keyboardDefault",button:"gt-keyboard-buttonDefault"},selection:{type:1},mapping:{}}};var k={etudPanel:{show:!0,displaySamples:!1,id:"gt-etudpanel",connectedClassName:"gt-etudpanel-connected"},etudriver:{port:8086,frequency:0},targets:[{selector:".gt-target",keyboard:null,selection:{type:j.selection.types.cumulativeDwell},mapping:{}}],mapping:{type:j.mapping.types.naive,source:j.mapping.sources.samples},pointer:{show:!0,size:8,color:"MediumSeaGreen",opacity:.5},smoother:{enabled:!0,low:300,high:10,timeWindow:50,threshold:25},progress:{color:"Teal",opacity:.5,size:60,minWidth:5,delay:200},fixdet:{maxFixSize:50,bufferLength:10},headCorrector:{enabled:!0,transformParam:500},headGesture:{timeWindow:800},customHeadGestureDetector:{calibration:{trials:5,threshold:.012,trialDuration:2e3,pauseDuration:2e3,plotSizeFactor:1,ui:{menu:"gt-chgd-calibMenu",list:"gt-chgd-calibList"}},detection:{maxAmplitudeError:.2,minCorrelation:.85,minPause:500,alterRefSignalOnDetection:!1}},css:{file:"gazeTargets",useVersion:!0},scroller:{enabled:!1,targets:{},speeds:[2,7,15,-1],controller:j.scroller.controllers.headPose,className:"gt-scroller",imageFolder:"images/scroller/",size:80,delay:800,headPose:{threshold:.005,transformParam:500}},calibVerifier:{display:!0,rows:4,columns:5,size:12,duration:1500,transitionDuration:800,displayResults:60,interpretationThreshold:20,pulsation:{enabled:!1,duration:600,size:20},className:{container:"gt-calibVerifier-containerDefault",target:"gt-calibVerifier-targetDefault",pulsator:"gt-calibVerifier-pulsatorDefault"},resultColors:{target:"#444",sample:"#48C",offset:"rgba(224,160,64,0.5)",text:"#444"}}},l={state:null,sample:null,target:null,keyboard:null};j.init=function(e,f){m=a.GazeTargets.Utils;var g=m.detectPath();E=g!==!1?g.path:"",m.extend(!0,k,e),m.extend(!0,l,f);var h=c();if(k.css.file){var i=E+k.css.file;k.css.useVersion&&g.version&&(i+="-"+g.version),i+=".css",b(i)}d(h),j.updateTargets(),a.GazeTargets.ETUDriver.init(k.etudriver,{data:F,state:G},n.etudriver)},j.updateTargets=function(){o=[];var a,b,c,d=function(a,b){a.gaze={focused:!1,selected:!1,attention:0,selection:b.selection,mapping:b.mapping,keyboard:b.keyboard?A[b.keyboard]:null},o.push(a)};for(var e in k.targets)for(a=k.targets[e],b=document.querySelectorAll(a.selector),c=0;c<b.length;c+=1)d(b[c],a);if(B)for(a=B.options,b=B.getDOM().querySelectorAll("."+p.button),c=0;c<b.length;c+=1)d(b[c],a);for(var f in k.scroller.targets)for(a=k.scroller.targets[f],b=document.querySelectorAll(a.selector),c=0;c<b.length;c+=1)d(b[c],a)},j.calibrateCustomHeadGesture=function(a,b){var c=z[a];return c?(c.init(c.modes.calibration,function(c){"finished"===c&&b&&b(a)}),!0):!1},j.getKeyboard=function(a){return A[a]},j.verifyCalibration=function(a,b){D.run(a,b)};var m,n={etudriver:{device:{id:"gt-etud-device","default":"Mouse"}}},o=[],p={button:"gt-keyboard-keyMarker",indicator:"gt-keyboard-indicator"},q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z={},A={},B=null,C=null,D=null,E="",F=function(a,b,c,d,e){var f=m.screenToClient(b,c);D.isActive()&&D.feed(a,b,c),w&&e&&(t||w.init(e),f=w.correct(f,e)),"function"==typeof l.sample&&l.sample(a,f.x,f.y,d,e),u.feed(a,f.x,f.y),I(k.mapping.type,f.x,f.y),e&&O(a,f,d,e),L(a,f.x,f.y,d,e),r&&v&&v.update(m.bool(r.gaze.selection.showProgress)?r:null),i(a,f),t={ts:a,x:b,y:c,pupil:d,ec:e}},G=function(b){m.bool(k.pointer.show)&&a.GazeTargets.Pointer.show(b.isTracking),v&&v.show(b.isTracking),"function"==typeof l.state&&l.state(b);var c,d;if(b.isTracking){x&&x.init(),C&&C.init(),q=null,r=null,s=null,t=null,j.updateTargets(),u.reset();for(c in z)d=z[c],d.init(d.modes.detection)}else{for(c in z)d=z[c],d.finilize();var e;for(e=0;e<o.length;e+=1){var f=o[e];f.gaze.focused=!1,f.gaze.selected=!1,f.gaze.mapping.className&&f.classList.remove(f.gaze.mapping.className)}B&&B.hide(),b.isStopped&&C&&C.reset()}},H=function(a){var b=!!B&&!a.classList.contains(p.button)||"hidden"===a.style.visibility||a.classList.contains(p.indicator);return b},I=function(a,b,c){var d=j.mapping.types,e=null;switch(k.mapping.source==j.mapping.sources.fixations&&u.currentFix&&(b=u.currentFix.x,c=u.currentFix.y),a){case d.naive:e=J(b,c);break;case d.expanded:e=K(b,c)}if(e!==q){var f;q&&(q.gaze.focused=!1,q.gaze.mapping.className&&q.classList.remove(q.gaze.mapping.className),f=new Event(j.events.left),q.dispatchEvent(f),"function"==typeof l.target&&l.target(j.events.left,q)),e&&(e.gaze.focused=!0,e.gaze.mapping.className&&e.classList.add(e.gaze.mapping.className),f=new Event(j.events.focused),e.dispatchEvent(f),"function"==typeof l.target&&l.target(j.events.focused,e),v&&v.moveTo(e)),q=e,q&&(r=q)}},J=function(a,b){var c,d=null;for(c=0;c<o.length;c+=1){var e=o[c];if(!H(e)){var f=e.getBoundingClientRect();if(a>=f.left&&a<f.right&&b>=f.top&&b<f.bottom)if(d){if(document.elementFromPoint(a,b)===e){d=e;break}}else d=e}}return d},K=function(a,b){var c,d=null,e=Number.MAX_VALUE;for(c=0;c<o.length;c+=1){var f=o[c];if(!H(f)){var g=f.getBoundingClientRect(),h=a<g.left?g.left-a:a>g.right?a-g.right:0,i=b<g.top?g.top-b:b>g.bottom?b-g.bottom:0,j=Math.sqrt(h*h+i*i);if(e>j&&j<k.mapping.expansion)d=f,e=j;else if(0===j&&document.elementFromPoint(a,b)===f){d=f;break}}}return d},L=function(a){var b,c=j.selection.types,d=null;for(b=0;b<o.length;b+=1){var e=o[b];if(!H(e)){switch(e.gaze.selection.type){case c.cumulativeDwell:t&&M(e,a-t.ts)&&(d=e);break;case c.simpleDwell:u.currentFix&&t&&N(e,a-t.ts)&&(d=e);break;case c.nod:d=y.current;break;case c.customHeadGesture:for(var f in z){var g=z[f];d=g.current||d}}if(d)break}}if(d!==s){if(s&&(s.gaze.selected=!1),d){d.gaze.selected=!0,d.gaze.selection.className&&(d.classList.add(d.gaze.selection.className),setTimeout(function(){d.classList.remove(d.gaze.selection.className)},d.gaze.selection.duration)),d.gaze.selection.audio&&d.gaze.selection.audio.play();var h=new Event(j.events.selected);d.dispatchEvent(h),"function"==typeof l.target&&l.target(j.events.selected,d),d.gaze.keyboard&&d.gaze.keyboard.show(d)}s=d}},M=function(a,b){var c,d=!1;if(a===q){if(a.gaze.attention+=b,a.gaze.attention>=a.gaze.selection.dwellTime)for(d=!0,c=0;c<o.length;c+=1){var e=o[c];e.gaze.selection.type===j.selection.types.cumulativeDwell&&(e.gaze.attention=0)}}else a.gaze.attention=Math.max(0,a.gaze.attention-b);return d},N=function(a,b){var c=!1;if(a===q){a.gaze.attention+=b;for(var d=0;d<o.length;d+=1){var e=o[d];e.gaze.selection.type===j.selection.types.simpleDwell&&e!==a&&(e.gaze.attention=0)}a.gaze.attention>=a.gaze.selection.dwellTime&&(c=!0,a.gaze.attention=0)}else a.gaze.attention=0;return c},O=function(a,b,c,d){if(y){var e=q&&q.gaze.selection.type===j.selection.types.nod;y.feed(a,b.x,b.y,c,d,e?q:null)}for(var f in z){var g=z[f],e=q&&q.gaze.selection.type===j.selection.types.customHeadGesture&&q.gaze.selection.name===g.getName();g.feed(a,d,e?q:null)}C&&C.feed(d)}}(window),function(a){"use strict";var b,c,d={init:function(d){b=d,c=a.GazeTargets.Utils,e=document.createElement("div"),e.className="gt-pointer";var f=e.style;f.display="none",f.backgroundColor=b.color,f.opacity=b.opacity,f.borderRadius=(b.size/2).toFixed(0)+"px",f.height=b.size+"px",f.width=b.size+"px",document.body.appendChild(e)},moveTo:function(a){e.style.left=Math.round(a.x-b.size/2)+"px",e.style.top=Math.round(a.y-b.size/2)+"px"},show:function(a){a&&"block"!==e.style.display?e.style.display="block":a||"block"!==e.style.display||(e.style.display="none")}},e=null;a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Pointer=d}(window),function(a){"use strict";var b,c={init:function(a){b=a,d=document.createElement("canvas"),d.className="gt-progress",d.height=b.size,d.width=b.size,d.style.display="none",document.body.appendChild(d)},show:function(a){a&&"block"!==d.style.display?d.style.display="block":a||"block"!==d.style.display||(d.style.display="none")},moveTo:function(a){if(d&&"undefined"!=typeof a.gaze.selection.dwellTime){var c=a.getBoundingClientRect();d.style.left=Math.round(c.left+(c.width-b.size)/2)+"px",d.style.top=Math.round(c.top+(c.height-b.size)/2)+"px"}},update:function(a){var c=d.getContext("2d"),e=b.size;if(c.clearRect(0,0,e,e),a){var f=Math.min(1,(a.gaze.attention-b.delay)/(a.gaze.selection.dwellTime-b.delay));f>0&&(c.beginPath(),c.lineWidth=Math.max(b.minWidth,e/10),c.arc(e/2,e/2,.45*e,-.5*Math.PI,-.5*Math.PI+2*Math.PI*f),c.strokeStyle=b.color,c.stroke())}}},d=null;a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Progress=c}(window),function(a){"use strict";function b(b){this.init=function(){c=!0},this.feed=function(a){if(b.controller===GazeTargets.scroller.controllers.headPose){d||(d=o(a));var e=o(a),f=e.y-d.y;Math.abs(f)>=b.headPose.threshold?(g.speed=(Math.abs(f)-b.headPose.threshold)*(0>f?-1:1)*b.headPose.transformParam,g.timer||(g.timer=setInterval(function(){return c?(g.speed&&scrollBy(0,g.speed),void 0):(clearInterval(g.timer),g.timer=null,void 0)},20))):(g.speed=0,g.timer&&(clearInterval(g.timer),g.timer=null))}},this.reset=function(){c=!1,d=null,g.speed=0,g.timer&&(clearInterval(g.timer),g.timer=null),f&&i(f)};var c=!1,d=null,e=[],f=null,g={speed:0,timer:null},h=function(a){a.classList.remove("gt-animation"),a.classList.remove("gt-animated-fadeOutHalf"),a.classList.add(b.className+"-keyOpaque"),a.classList.add("gt-animated-fadeInHalf"),a.classList.add("gt-animated"),f=a},i=function(a){a.classList.remove(b.className+"-keyOpaque"),a.classList.remove("gt-animation"),a.classList.remove("gt-animated-fadeInHalf"),a.classList.add("gt-animated-fadeOutHalf"),a.classList.add("gt-animated"),f=null},j=function(){if(!this.scroller.timer){var a=this.scroller.speed,b=this.scroller.direction,d=this;this.scroller.timer=setInterval(function(){return c?(a>0?scrollBy(0,a*b):0>a&&scrollBy(0,Math.round(.9*window.innerHeight*b)),void 0):(clearInterval(d.scroller.timer),d.scroller.timer=null,i(d),void 0)},a>0?20:1e3)}},k=function(){h(this)},l=function(){this.scroller.timer&&(clearInterval(this.scroller.timer),this.scroller.timer=null),i(this)},m=function(c,d){for(var f=c.insertRow(-1),g=0;g<b.speeds.length;g+=1){var h=b.speeds[g],i=document.createElement("div");i.className=b.className+"-key";var m=d?"Up":"Down",n="";h>0?(n="smooth"+m,i.classList.add(b.className+"-smooth")):0>h&&(n="page"+m,i.classList.add(b.className+"-page")),n&&(i.style.backgroundImage="url('"+b.imageFolder+n+".png')"),i.scroller={speed:h,direction:d?-1:1,timer:null},i.addEventListener(a.GazeTargets.events.selected,j),i.addEventListener(a.GazeTargets.events.focused,k),i.addEventListener(a.GazeTargets.events.left,l);var o=f.insertCell(-1);o.appendChild(i),e.push(i)}},n=function(a){var c=document.createElement("table");c.className=b.className,c.classList.add(b.className+(a?"-upper":"-lower")),m(c,a),document.body.appendChild(c)},o=function(a){var b=0,c=0,d=0;return a.xl&&(c+=a.xl,d+=a.yl,b+=1),a.xr&&(c+=a.xr,d+=a.yr,b+=1),b&&(c/=b,d/=b),{x:c,y:d}};if(b.controller===a.GazeTargets.scroller.controllers.fixation){n(!0),n(!1)}}a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Scroller=b}(window),function(a){"use strict";function b(a){this.x=-1,this.y=-1,this.t=0,this.interval=0,this.buffer=[],this.init=function(){this.x=-1,this.y=-1,this.t=0,this.buffer=[]},this.smooth=function(b,c,d){this.x<0&&this.y<0&&0===this.t&&(this.x=c,this.y=d,this.t=a.low);var e,f=0,g=0,h=0,i=0,j=0,k=0,l=!1;for(this.buffer.push({ts:b,x:c,y:d}),e=0;e<this.buffer.length;e+=1){var m=this.buffer[e],n=b-m.ts;n>2*a.timeWindow?(this.buffer.shift(),l=!0):n>a.timeWindow?(f+=m.x,g+=m.y,j++):(h+=m.x,i+=m.y,k++)}if(j&&k){f/=j,g/=j,h/=k,i/=k;var o=f-h,p=g-i,q=Math.sqrt(o*o+p*p);this.t=q>a.threshold?a.high:a.low}if(l&&!this.interval&&this.buffer.length>1){var r=0;for(e=1;e<this.buffer.length;e+=1)r+=this.buffer[e].ts-this.buffer[e-1].ts;this.interval=r/(this.buffer.length-1)}if(this.interval){var s=this.t/this.interval;this.x=(c+s*this.x)/(1+s),this.y=(d+s*this.y)/(1+s)}return{x:this.x,y:this.y}}}a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Smoother=b}(window),function(a){"use strict";var b={};b.debug=function(){var a=Array.prototype.join.call(arguments,": ");console.log(a)},b.exception=function(){var a=Array.prototype.join.call(arguments,": ");console.error(a)};var c=function(){var a=!0;try{a=!!localStorage}catch(b){a=!1}return a};b.getStoredValue=function(a){var b=a.default;return c()&&(b=localStorage[a.id]||b),b},b.store=function(a,b){c()&&(localStorage[a.id]=b)};var d={x:1,y:1},e={x:0,y:0};b.updatePixelConverter=function(){if("undefined"==typeof devicePixelRatio){var a=function(a){var b,c,d=0,e=function(a,b,c){for(var e=window.matchMedia;a>=b&&!e("(min-resolution: "+a/c+"dppx)").matches;)a-=1,d+=1;return a},f=5,g=.1,h=1;for(c=0;a>c;c+=1)b=10*e(f,g,h),f=b+9,g=b,h*=10;return b/h}(5);d={x:a,y:a}}else d={x:devicePixelRatio,y:devicePixelRatio};if(window.mozInnerScreenX)e={x:window.mozInnerScreenX*d.x,y:window.mozInnerScreenY*d.y};else{var b=window.innerWidth*d.x,c=window.innerHeight*d.y;e={x:window.screenX+(window.outerWidth-b)/2,y:window.screenY+(window.outerHeight-c)-(window.outerWidth-b)/2}}},b.screenToClient=function(a,b){return{x:(a-e.x)/d.x,y:(b-e.y)/d.y}},b.clientToScreen=function(a,b){return{x:a*d.x+e.x,y:b*d.x+e.y}},b.getScreenSize=function(){var a;return a=window.mozInnerScreenX?{width:Math.round(screen.width*d.x),height:Math.round(screen.height*d.y)}:{width:screen.width,height:screen.height}},b.getRandomInt=function(){var a=arguments.length>1?arguments[0]:0,b=arguments.length>0?arguments[arguments.length-1]:4294967295;return Math.floor(Math.random()*(b-a+.99999))+a},b.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var c=new Date;return c.setTime(a.getTime()),c}if(a instanceof Array){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b.clone(a[d]);return c}if(a instanceof Object){var c=a.constructor();for(var f in a)a.hasOwnProperty(f)&&(c[f]=a[f]===a?c:b.clone(a[f]));return c}return void 0},b.detectPath=function(a){var b,c=function(a){function b(a){for(var b="";a;)if("../"===a.substr(0,3)||"./"===a.substr(0,2))a=a.replace(/^\.+/,"").substr(1);else if("/./"===a.substr(0,3)||"/."===a)a="/"+a.substr(3);else if("/../"===a.substr(0,4)||"/.."===a)a="/"+a.substr(4),b=b.replace(/\/?[^\/]*$/,"");else if("."===a||".."===a)a="";else{var c=a.match(/^\/?[^\/]*/)[0];a=a.substr(c.length),b+=c}return b}this.scheme=null,this.authority=null,this.path="",this.query=null,this.fragment=null,this.parse=function(a){var b=a.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=b[3]?b[2]:null,this.authority=b[5]?b[6]:null,this.path=b[7],this.query=b[9]?b[10]:null,this.fragment=b[12]?b[13]:null,this},this.toString=function(){var a="";return null!==this.scheme&&(a=a+this.scheme+":"),null!==this.authority&&(a=a+"//"+this.authority),null!==this.path&&(a+=this.path),null!==this.query&&(a=a+"?"+this.query),null!==this.fragment&&(a=a+"#"+this.fragment),a},this.toAbsolute=function(a){a=new c(a);var d=this,e=new c;return null===a.scheme?!1:(null!==d.scheme&&d.scheme.toLowerCase()===a.scheme.toLowerCase()&&(d.scheme=null),null!==d.scheme?(e.scheme=d.scheme,e.authority=d.authority,e.path=b(d.path),e.query=d.query):(null!==d.authority?(e.authority=d.authority,e.path=b(d.path),e.query=d.query):(""===d.path?(e.path=a.path,e.query=null!==d.query?d.query:a.query):("/"===d.path.substr(0,1)?e.path=b(d.path):(e.path=null!==a.authority&&""===a.path?"/"+d.path:a.path.replace(/[^\/]+$/,"")+d.path,e.path=b(e.path)),e.query=d.query),e.authority=a.authority),e.scheme=a.scheme),e.fragment=d.fragment,e)},a&&this.parse(a)},d=location.href,e=document.getElementsByTagName("base");for(b=0;b<e.length;b+=1)e[b].href&&(d=e[b].href);var f=a||/(^|\/)gazeTargets(-(\d+)\.(\d+)\.(\d+))?\.js([?#].*)?$/i;for(e=document.getElementsByTagName("script"),b=0;b<e.length;b+=1)if(e[b].src){var g=f.exec(e[b].src);if(g){var h=new c(e[b].src),i=h.toAbsolute(d);return i.path=i.path.replace(/[^\/]+$/,""),i.query=null,i.fragment=null,{path:i.toString(),version:"undefined"!=typeof g[2]?g[3]+"."+g[4]+"."+g[5]:""}}}return!1},b.extend=function(){var a,c,d,e,f,g,h=function(a){return"object"!=typeof a||a.nodeType||a===a.window?!1:!0},i=arguments[0]||{},j=1,k=arguments.length,l=!1,m=!1;if("boolean"==typeof i&&(l=i,i=arguments[j]||{},j+=1),"boolean"==typeof i&&(m=i,i=arguments[j]||{},j+=1),"object"!=typeof i&&"function"!=typeof i&&(i={}),k===j)return i;for(;k>j;j+=1)if(null!=(a=arguments[j]))for(c in a)d=i[c],e=a[c],i!==e&&(l&&e&&(h(e)||(f=Array.isArray(e)))?(f?(f=!1,g=d&&Array.isArray(d)?d:[]):g=d&&h(d)?d:{},i[c]=b.extend(l,g,e)):void 0!==e&&(m&&void 0!==i[c]||(i[c]=e)));return i},b.bool=function(a){var b=typeof a;if("function"===b)return a();if(a instanceof Array)return a.length>0;if("object"===b){for(var c in a)return!0;return!1}return!!a},a.GazeTargets||(a.GazeTargets={}),a.GazeTargets.Utils=b}(window);